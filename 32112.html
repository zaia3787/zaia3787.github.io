<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>åœ–é¨°åŠ å·¥å»  3.0 - å‡½æ•¸å®šç¾©æŒ‘æˆ°</title>
    <style>
        body { font-family: 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; background: #1e1e1e; color: #fff; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        
        /* ä»»å‹™é¢æ¿ç½®ä¸­ */
        #task-panel { 
            width: 700px; background: #333; padding: 20px; border-radius: 12px; 
            border: 2px solid #555; text-align: center; margin-bottom: 20px;
        }
        .target-list { display: flex; gap: 15px; justify-content: center; margin-top: 10px; }
        .target-item { width: 30px; height: 30px; border: 2px solid #fff; line-height: 30px; font-weight: bold; }

        /* 3x24 ç‹¹é•·ç•«å¸ƒ */
        #production-line { 
            display: grid; 
            grid-template-columns: repeat(24, 25px); 
            grid-template-rows: repeat(3, 25px); 
            gap: 2px; background: #444; padding: 10px; border: 4px solid #888;
        }
        .cell { width: 25px; height: 25px; background: #222; cursor: crosshair; }

        /* æ§åˆ¶å€ä½ˆå±€ */
        .main-ui { display: flex; gap: 40px; margin-top: 30px; align-items: flex-start; }
        .control-box { background: #333; padding: 20px; border-radius: 8px; width: 260px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        
        /* 3x3 å°ç« ç·¨è¼¯å™¨ */
        #editor-grid { 
            display: grid; grid-template-columns: repeat(3, 40px); grid-template-rows: repeat(3, 40px); 
            gap: 4px; background: #555; padding: 8px; margin: 15px auto; width: 128px;
        }
        .edit-cell { width: 40px; height: 40px; background: #222; cursor: pointer; border: 1px solid #444; }
        .edit-cell.active { background: #00d2ff; box-shadow: inset 0 0 10px #0088aa; }

        .color-picker { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin: 10px 0; }
        .color-btn { height: 30px; border: 2px solid transparent; cursor: pointer; border-radius: 4px; }
        .color-btn.active { border-color: white; transform: scale(1.1); }

        #timer { font-size: 32px; color: #ff4757; font-weight: bold; margin-bottom: 10px; text-shadow: 0 0 10px rgba(255,71,87,0.5); }
        button { cursor: pointer; padding: 10px 15px; border: none; border-radius: 4px; font-weight: bold; transition: 0.2s; }
        .btn-start { background: #2ecc71; color: white; padding: 15px 0; font-size: 20px; width: 100%; margin-top: 15px; }
        .btn-mode { width: 100%; margin: 5px 0; background: #444; color: #ccc; border: 1px solid #555; }
        .btn-mode.active { background: #3498db; color: white; border-color: #fff; }
        
        hr { border: 0; border-top: 1px solid #555; margin: 15px 0; }
    </style>
</head>
<body>

    <div id="task-panel">
        <h2>ğŸ­ ç”Ÿç”¢ç·šä»»å‹™ï¼šç²¾å¯†åœ–é¨°åŠ å·¥</h2>
        <p>è«‹åœ¨é™æ™‚å…§ï¼Œæ–¼ä¸‹æ–¹ç”Ÿç”¢ç·šå°å‡º <b>8 å€‹æŒ‡å®šçš„åå­—åœ–é¨° (+)</b></p>
        <div class="target-list" id="targets"></div>
    </div>

    <div id="timer">å‰©é¤˜æ™‚é–“ï¼š-- ç§’</div>

    <div id="production-line"></div>

    <div class="main-ui">
        <div class="control-box">
            <h3 style="margin-top:0">ğŸ¨ å·¥å…·ç®±</h3>
            <p style="font-size:13px; color:#bbb">1. é¸æ“‡é¡è‰² (åƒæ•¸)</p>
            <div class="color-picker" id="pickers"></div>
            
            <hr>
            
            <p style="font-size:13px; color:#bbb">2. é¸æ“‡æ“ä½œæ¨¡å¼</p>
            <button class="btn-mode active" id="mode-m" onclick="setMode('manual')">å–®é»æ‰‹å‹•å¡—è‰²</button>
            <button class="btn-mode" id="mode-s" onclick="setMode('stamp')">ä½¿ç”¨è‡ªè¨‚å°ç« æ¨¡çµ„</button>
            
            <button class="btn-start" id="start-btn" onclick="startGame()">é–‹å§‹æŒ‘æˆ°</button>
        </div>

        <div class="control-box" style="border-top: 5px solid #e67e22;">
            <h3 style="margin-top:0">âš™ï¸ å®šç¾©å°ç« æ¨¡çµ„ (3x3)</h3>
            <p style="font-size: 13px; color: #bbb;">åœ¨é€™è£¡è¨­è¨ˆä½ çš„ã€Œåå­—åœ–é¨°ã€é‚è¼¯ï¼š</p>
            <div id="editor-grid"></div>
            <p style="font-size: 12px; color: #888; text-align:center;">æç¤ºï¼šé»æ“Šæ ¼å­çµ„æˆã€Œ+ã€å½¢ç‹€</p>
            <button style="width:100%; margin-top:10px; background:#555; color:white;" onclick="clearEditor()">é‡ç½®è¨­è¨ˆ</button>
        </div>
    </div>

<script>
    const colors = ['#ff4757', '#2e90d5', '#2ed573', '#ffa502', '#ffffff', '#eccc68', '#7bed9f', '#70a1ff'];
    let currentColor = colors[0];
    let mode = 'manual';
    let timeLeft = 30;
    let gameActive = false;
    let finishedColors = new Set();
    let stampMatrix = []; // å­˜å„² 3x3 çš„ç›¸å°åº§æ¨™

    // 1. åˆå§‹åŒ–ç•«å¸ƒ (3x24)
    const line = document.getElementById('production-line');
    for (let i = 0; i < 72; i++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.onclick = () => handleCellClick(i);
        line.appendChild(cell);
    }

    // 2. åˆå§‹åŒ– 3x3 ç·¨è¼¯å™¨
    const editor = document.getElementById('editor-grid');
    const editCells = [];
    for (let i = 0; i < 9; i++) {
        const ec = document.createElement('div');
        ec.className = 'edit-cell';
        ec.onclick = () => {
            ec.classList.toggle('active');
            updateStampMatrix();
        };
        editor.appendChild(ec);
        editCells.push(ec);
    }

    // 3. åˆå§‹åŒ–ä»»å‹™èˆ‡é¡è‰²
    const pickers = document.getElementById('pickers');
    const targets = document.getElementById('targets');
    colors.forEach(c => {
        const t = document.createElement('div');
        t.className = 'target-item'; t.id = 'target-' + c; t.style.backgroundColor = c; t.innerText = "+";
        targets.appendChild(t);

        const p = document.createElement('button');
        p.className = 'color-btn'; p.style.backgroundColor = c;
        if(c === currentColor) p.classList.add('active');
        p.onclick = () => {
            currentColor = c;
            document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
            p.classList.add('active');
        };
        pickers.appendChild(p);
    });

    function updateStampMatrix() {
        stampMatrix = [];
        editCells.forEach((cell, idx) => {
            if (cell.classList.contains('active')) {
                // ä»¥ 3x3 ä¸­å¿ƒ (1,1) ç‚ºåŸé» (0,0)
                const x = idx % 3 - 1;
                const y = Math.floor(idx / 3) - 1;
                stampMatrix.push({dx: x, dy: y});
            }
        });
    }

    function clearEditor() {
        editCells.forEach(c => c.classList.remove('active'));
        stampMatrix = [];
    }

    function setMode(m) {
        mode = m;
        document.getElementById('mode-m').classList.toggle('active', m === 'manual');
        document.getElementById('mode-s').classList.toggle('active', m === 'stamp');
    }

    function startGame() {
        timeLeft = 15;
        gameActive = true;
        finishedColors.clear();
        document.querySelectorAll('.cell').forEach(c => c.style.backgroundColor = '#222');
        document.querySelectorAll('.target-item').forEach(t => t.style.opacity = '1');
        document.getElementById('start-btn').disabled = true;
        
        const timerInterval = setInterval(() => {
            timeLeft--;
            document.getElementById('timer').innerText = `å‰©é¤˜æ™‚é–“ï¼š${timeLeft} ç§’`;
            if (timeLeft <= 0 || finishedColors.size === colors.length) {
                clearInterval(timerInterval);
                endGame();
            }
        }, 1000);
    }

    function handleCellClick(idx) {
        if (!gameActive) return;
        const baseX = idx % 24;
        const baseY = Math.floor(idx / 24);

        if (mode === 'manual') {
            paint(baseX, baseY, currentColor);
        } else {
            // å‘¼å«å°ç« ã€Œå‡½æ•¸ã€
            if (stampMatrix.length === 0) {
                alert("è«‹å…ˆåœ¨å³å´ç·¨è¼¯å™¨å®šç¾©å°ç« åœ–æ¡ˆï¼");
                return;
            }
            stampMatrix.forEach(offset => {
                paint(baseX + offset.dx, baseY + offset.dy, currentColor);
            });
            checkFinished(currentColor);
        }
    }

    function paint(x, y, color) {
        if (x >= 0 && x < 24 && y >= 0 && y < 3) {
            line.children[y * 24 + x].style.backgroundColor = color;
        }
    }

    function checkFinished(color) {
        finishedColors.add(color);
        document.getElementById('target-' + color).style.opacity = '0.3';
    }

    function endGame() {
        gameActive = false;
        document.getElementById('start-btn').disabled = false;
        if (finishedColors.size === colors.length) {
            alert("ğŸŠ ä»»å‹™é”æˆï¼\nä½ ç™¼ç¾äº†å—ï¼Ÿå®šç¾©ä¸€å€‹ã€Œ3x3 å°ç« ã€å°±åƒå¯«ä¸€å€‹å‡½æ•¸ï¼Œé»æ“Šä¸€ä¸‹å°±èƒ½åŸ·è¡Œå¤šå€‹æ­¥é©Ÿï¼");
        } else {
            alert("â° æ™‚é–“åˆ°ï¼\nå–®é»å¡—è‰²å¤ªæ…¢äº†ã€‚è©¦è‘—å®šç¾©ä¸€å€‹ 3x3 çš„ã€Œåå­—å°ç« ã€æ¨¡çµ„ä¾†å¤§å¹…æå‡æ•ˆç‡ï¼");
        }
    }
</script>

</body>
</html>